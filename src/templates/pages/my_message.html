<ion-view id="my_message">
	<ion-nav-title align-title="center"><span class="ui inverted header">我的消息</span></ion-nav-title>
	<ion-content overflow-scroll="false" has-bouncing="true" class="has-header" style="background-color: #f8f8f8;">
		<div class="list" style="margin-top: 10px;">

			<!--	<a class="item item-icon-left item-icon-right" style="padding-left: 74px;" href="#">
				<i class="icon" style="left: 31px;"><span class="icon-my_message_list">
                <span class="path1"></span><span class="path2"></span>
                </span></i> 聊天列表
				<i class="icon"><span class="icon-common_rightarrow item_common_arrow_right"></span></i>
			</a>-->

			<!--<a class="item item-icon-left item-icon-right item-input" style="padding-left: 55px;height:50px" ng-click="gotoMsgList(0)">
				<i class="icon iconleft"><span class="icon-my_message_system">
                <span class="path1"></span><span class="path2"></span>
                </span></i> 系统消息
				<span class="badge badge-assertive" style="left: 120px;right: auto;background-color: #39d0e7;" ng-if="NoticeCountObj.sysMsgCount!=0">{{NoticeCountObj.sysMsgCount}}</span>
				<i class="icon"><span class="icon-common_rightarrow item_common_arrow_right iconright"></span></i>
			</a>-->

			<a class="item item-icon-left item-icon-right item-input" style="padding-left: 55px;height:50px" ng-click="gotoMsgList(1)">
				<i class="icon iconleft"><span class="icon-my_message_activity">
                <span class="path1"></span><span class="path2"></span><span class="path3"></span>
                </span></i> 活动提醒
				<span class="badge badge-assertive" style="left: 140px;right: auto;background-color: #39d0e7;" ng-if="noticeCount.activityNoticeCount!=0">{{noticeCount.activityNoticeCount}}</span>
				<i class="icon"><span class="icon-common_rightarrow item_common_arrow_right iconright"></span></i>
			</a>

			<a class="item item-icon-left item-icon-right item-input" style="padding-left: 55px;height:50px" ng-click="gotoMsgList(2)">
				<i class="icon iconleft"><span class="icon-my_message_official">
                <span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span>
             </span></i> 系统通知
				<span class="badge badge-assertive" style="left: 140px;right: auto;background-color: #39d0e7;" ng-if="noticeCount.sysNoticeCount!=0">{{noticeCount.sysNoticeCount}}</span>
				<i class="icon"><span class="icon-common_rightarrow item_common_arrow_right iconright"></span></i>
			</a>
	        <a class="item item-icon-left item-icon-right item-input" style="padding-left: 55px;height:50px" ng-click="openWindow('sys_news_list')">
				<i class="icon iconleft"><span class="icon-home_nav_release">
             <span class="path1"></span><span class="path2"></span><span class="path3"></span>
            </span></i> 官方通知
				<i class="icon"><span class="icon-common_rightarrow item_common_arrow_right iconright"></span></i>
			</a>
			<a class="item item-icon-left item-icon-right item-input" style="padding-left: 55px;height:50px" href="#/my_comment">
				<i class="icon iconleft"><span class="icon-my_message_scor">
                <span class="path1"></span><span class="path2"></span>
                </span></i> 我的评分
				<i class="icon"><span class="icon-common_rightarrow item_common_arrow_right iconright"></span></i>
			</a>
			<a class="item item-icon-left item-icon-right item-input" style="padding-left: 55px;height:50px" href="#/news_all">
				<i class="icon iconleft"><span class="icon-home_nav_news"> <span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span>
                </span>
               </i> 活动新闻
				<i class="icon"><span class="icon-common_rightarrow item_common_arrow_right iconright"></span></i>
			</a>

		</div>
	</ion-content>
</ion-view>
<script type="text/javascript">
	var offset = 0;
	var limit = 10;

	function pageCtrl($scope, $http, $rootScope, $ionicHistory, $timeout, $ionicModal, $ionicPopup, EventBus, $ionicPopover, Upload, $ionicLoading) {
		$scope.NoticeCountObj = {
			msgAllcount: 0,
			sysMsgCount: 0,
			activityNoticeCount: 0,
			sysNoticeCount: 0
		};
		
		$scope.noticeCount = {
			activityNoticeCount: 0,
			sysNoticeCount: 0
		};
		$scope.init = function() {
			db.get("receiveNotificationCount", function(data) {
				if(data){
					$scope.NoticeCountObj = data;
					$scope.noticeCount.activityNoticeCount =data.activityNoticeCount;
					$scope.noticeCount.sysNoticeCount = parseInt(data.sysNoticeCount)+parseInt(data.sysMsgCount);
					console.log("活动提醒："+$scope.noticeCount.activityNoticeCount+"系统通知："+$scope.noticeCount.sysNoticeCount);
				}else{
					console.log("消息为0");
				}
			})
		}

		$scope.gotoMsgList = function(type) {
			var allCount = parseInt($scope.NoticeCountObj.msgAllcount);
			switch (type) {
				/*case 0:
					$scope.NoticeCountObj.msgAllcount = allCount - parseInt($scope.NoticeCountObj.sysMsgCount);
					$scope.NoticeCountObj.sysMsgCount = 0;
					break;*/
				case 1:
					$scope.NoticeCountObj.msgAllcount = allCount - parseInt($scope.NoticeCountObj.activityNoticeCount);
					$scope.NoticeCountObj.activityNoticeCount = 0;
					$scope.noticeCount.activityNoticeCount =0;
					break;
				case 2:
					$scope.NoticeCountObj.msgAllcount = allCount - parseInt($scope.NoticeCountObj.sysNoticeCount)- parseInt($scope.NoticeCountObj.sysMsgCount);
					$scope.NoticeCountObj.sysNoticeCount = 0;
					$scope.NoticeCountObj.sysMsgCount = 0;
					$scope.noticeCount.sysNoticeCount =0;
					break;
			}
			console.log("消息总数："+$scope.NoticeCountObj.msgAllcount);
			$scope.$parent.loadReviceData($scope.NoticeCountObj);
			$scope.openWindow('my_sysmsg_list', {
				msgType: type
			});
		}

		$scope.init();
		//推送消息数据刷新事件订阅
		EventBus.on("notice.index.receiveNotification", function(evt) {
			if ($scope.$parent) {
				if ($scope.isRefreshData) {
					$scope.$broadcast('scroll.refreshComplete');
					$scope.isRefreshData = false;
				}
				if (evt && _.isObject(evt.data)){
					$scope.NoticeCountObj = evt.data;
					$scope.noticeCount.activityNoticeCount =$scope.NoticeCountObj.activityNoticeCount;
					$scope.noticeCount.sysNoticeCount = parseInt($scope.NoticeCountObj.sysNoticeCount)+parseInt($scope.NoticeCountObj.sysMsgCount);
				}
			}
		});
	}
</script>